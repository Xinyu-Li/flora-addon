!function(t){"function"==typeof define&&define.amd?define(["jquery","datatables.net"],function(e){return t(e,window,document)}):"object"==typeof exports?module.exports=function(e,a){return e||(e=window),a&&a.fn.dataTable||(a=require("datatables.net")(e,a).$),t(a,e,e.document)}:t(jQuery,window,document)}(function(t,e,a,o){"use strict";var i=t.fn.dataTable,n=0,l=function(e,a){if(!i.versionCheck||!i.versionCheck("1.10.8"))throw"Warning: altEditor requires DataTables 1.10.8 or greater";this.c=t.extend(!0,{},i.defaults.altEditor,l.defaults,a),this.s={dt:new i.Api(e),namespace:".altEditor"+n++},this.dom={modal:t('<div class="dt-altEditor-handle"/>')},this._constructor()};return t.extend(l.prototype,{_constructor:function(){var e=this,i=this.s.dt;i.settings()[0].oInit.onAddRow&&(e.onAddRow=i.settings()[0].oInit.onAddRow),i.settings()[0].oInit.onDeleteRow&&(e.onDeleteRow=i.settings()[0].oInit.onDeleteRow),i.settings()[0].oInit.onEditRow&&(e.onEditRow=i.settings()[0].oInit.onEditRow),e.closeModalOnSuccess=i.settings()[0].oInit.closeModalOnSuccess,e.closeModalOnSuccess===o&&(e.closeModalOnSuccess=!0),e.encodeFiles=i.settings()[0].oInit.encodeFiles,e.encodeFiles===o&&(e.encodeFiles=!0);var n=this.s.dt.settings()[0].oLanguage;n.altEditor?(this.language=n.altEditor,this._setup()):"string"==typeof n.altEditorUrl&&""!=n.altEditorUrl?t.ajax({dataType:"json",url:n.altEditorUrl,success:function(t){e.language=t,e._setup()},error:function(){e.language={},e._setup()}}):(this.language={},this._setup()),i.on("destroy.altEditor",function(){i.off(".altEditor"),t(i.table().body()).off(e.s.namespace),t(a.body).off(e.s.namespace)})},_setup:function(){var e=this,a=this.s.dt;this.random_id=(""+Math.random()).replace(".","");var o="altEditor-modal-"+this.random_id;this.modal_selector="#"+o,this._initLanguage();var i='<div class="modal fade altEditor-modal reveal" id="'+o+'" tabindex="-1" role="dialog" data-reveal><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 style="padding-top: 1rem;padding-left: 1rem;" class="modal-title"></h4><button style="margin: initial;" type="button" class="close close-button" data-dismiss="modal" data-close aria-label="'+this.language.modalClose+'"><span aria-hidden="true">&times;</span></button></div><div class="modal-body"><p></p></div><div class="modal-footer"></div></div></div></div>';t("body").append(i),a.button("edit:name")&&a.button("edit:name").action(function(a,o,i,n){e._openEditModal(),t("#altEditor-edit-form-"+e.random_id).off("submit").on("submit",function(t){t.preventDefault(),t.stopPropagation(),e._editRowData()})}),a.button("delete:name")&&a.button("delete:name").action(function(a,o,i,n){e._openDeleteModal(),t("#altEditor-delete-form-"+e.random_id).off("submit").on("submit",function(t){t.preventDefault(),t.stopPropagation(),e._deleteRow()})}),a.button("add:name")&&a.button("add:name").action(function(a,o,i,n){e._openAddModal(),t("#altEditor-add-form-"+e.random_id).off("submit").on("submit",function(t){t.preventDefault(),t.stopPropagation(),e._addRowData()})}),t(this.modal_selector).on("input","[data-unique]",function(o){if(null!=t(o.target).attr("data-unique")&&"false"!==t(o.target).attr("data-unique")){var i=t(o.target),n=a.column("th:contains('"+i.attr("name")+"')").data(),l=null;for(var r in null!=a.row({selected:!0}).index()&&(l=a.cell(a.row({selected:!0}).index(),a.column("th:contains('"+i.attr("name")+"')").index()).data()),o.target.setCustomValidity(""),n)i.val()==n[r]&&n[r]!=l&&o.target.setCustomValidity(e.language.error.unique)}}),this.s.dt.button("refresh:name")&&this.s.dt.button("refresh:name").action(function(t,e,a,o){e.ajax&&e.ajax.url()&&e.ajax.reload()})},_initLanguage:function(){this.language.modalClose=this.language.modalClose||"Close",this.language.edit=this.language.edit||{},this.language.edit={title:this.language.edit.title||"Edit record",button:this.language.edit.button||"Edit"},this.language.delete=this.language.delete||{},this.language.delete={title:this.language.delete.title||"Delete record",button:this.language.delete.button||"Delete"},this.language.add=this.language.add||{},this.language.add={title:this.language.add.title||"Add record",button:this.language.add.button||"Add"},this.language.success=this.language.success||"Success!",this.language.error=this.language.error||{},this.language.error={message:this.language.error.message||"There was an unknown error!",label:this.language.error.label||"Error!",responseCode:this.language.error.responseCode||"Response code: ",required:this.language.error.required||"Field is required",unique:this.language.error.unique||"Duplicated field"}},_emitEvent:function(e,a){this.s.dt.iterator("table",function(o,i){t(o.nTable).triggerHandler(e+".dt",a)})},_openEditModal:function(){var e=this.s.dt.rows({selected:!0}),a=this.completeColumnDefs(),i=(this.createDialog(a,this.language.edit.title,this.language.edit.button,this.language.modalClose,"editRowBtn","altEditor-edit-form"),this.modal_selector);for(var n in a)if(null!=a[n].name){for(var l="#"+a[n].name.toString().replace(/\./g,"\\."),r=a[n].name.toString().split("."),d=e.data()[0],s=0;s<r.length;s++)d&&(d=d[r[s]]);if("object"!=typeof d&&null!==d&&(d=d.toString().trim()),a[n].type.indexOf("select")>=0&&a[n].select2){var u=o;try{u=JSON.parse(d)}catch(t){}"object"==typeof u&&(d=u)}else if(a[n].type.indexOf("checkbox")>=0)"true"!==this._quoteattr(d)&&"1"!=this._quoteattr(d)||t(i).find(l).prop("checked",this._quoteattr(d));else if(a[n].type.indexOf("date")>=0&&""!==a[n].dateFormat){var c=moment(this._quoteattr(d));c&&c.isValid()&&t(i).find(l).val(c.format(a[n].dateFormat))}t(i).find(l).filter(':input[type!="file"]').val(d).trigger("change")}t(i+" input[0]").trigger("focus"),t(i).trigger("alteditor:some_dialog_opened").trigger("alteditor:edit_dialog_opened")},_editRowData:function(){var e=this,a=this.s.dt.rows({selected:!0}),o={},i=a.data()[0],n=t('form[name="altEditor-edit-form-'+this.random_id+'"]').find("select, textarea, input");n.filter(':input[type!="file"], :input[type="checkbox"]').each(function(e){o[t(this).attr("id")]=t(this).val()});var l=0;n.filter(':input[type="file"]').each(function(a){if(t(this).prop("files")[0]){var i=this;e.encodeFiles?(++l,e.getBase64(t(this).prop("files")[0],function(e){o[t(i).attr("id")]=e,--l})):o[t(this).attr("id")]=t(this).prop("files")[0]}}),n.filter(':input[type="checkbox"]').each(function(e){o[t(this).attr("id")]=this.checked});var r=function(){0==l?e.onEditRow(e,o,function(t,a,o,i,n){e._editRowCallback(t,a,o,i,n)},function(t){e._errorCallback(t)},i):(console.log("Waiting for file base64-decoding..."),setTimeout(r,1e3))};r()},_openDeleteModal:function(){var e=this,a=this.s.dt.rows({selected:!0}),i=this.completeColumnDefs(),n="altEditor-delete-form-"+this.random_id,l="";for(var r in i){var d=i[r].title.replace(/(<([^>]+)>)/gi,"").trim();if(null!=i[r].name)if(i[r].type.indexOf("hidden")>=0)l+="<input type='hidden' id='"+d+"' value='"+a.data()[0][i[r].name]+"'></input>";else if(i[r].type.indexOf("file")<0){for(var s=i[r].name.toString().split("."),u=a.data()[0],c=0;c<s.length;c++)u&&(u=u[s[c]]);if(i[r].type.indexOf("date")>=0&&""!==i[r].dateFormat){var p=moment(a.data()[0][i[r].name]);p&&p.isValid()&&(u=p.format(i[r].dateFormat))}if(i[r].type.indexOf("select")>=0){var f=i[r].options,g=function(t){return f.length===o?t in f?f[t]:null:t};if(u instanceof Array){var m=u.map(g).filter(function(t){return null!=t});u=m.join(", ")}else u=g(u)}l+="<div style='margin-left: initial; margin-right: initial;' class='form-group row'><label for='"+e._quoteattr(i[r].name)+"'>"+d+":&nbsp</label><input type='hidden' id='"+e._quoteattr(d)+"' name='"+e._quoteattr(d)+"' placeholder='"+e._quoteattr(d)+"' style='overflow: hidden;' class='form-control' value='"+e._quoteattr(u)+"' >"+u+"</input></div>"}}var h=this.modal_selector;this.internalOpenDialog(h,function(){var a='<button type="button" data-content="remove" class="btn btn-default button secondary" data-close data-dismiss="modal">'+e.language.modalClose+'</button><button type="submit"  data-content="remove" class="btn btn-danger button" id="deleteRowBtn">'+e.language.delete.button+"</button>";t(h).find(".modal-title").html(e.language.delete.title),t(h).find(".modal-body").html(l),t(h).find(".modal-footer").html(a);var o=t(h).find(".modal-content");o.parent().is("form")?(o.parent().attr("name",n),o.parent().attr("id",n)):o.wrap("<form name='"+n+"' id='"+n+"' role='form'></form>")}),t(h+" input[0]").trigger("focus"),t(h).trigger("alteditor:some_dialog_opened").trigger("alteditor:delete_dialog_opened")},_deleteRow:function(){for(var t=this,e=this.s.dt,a={},o=e.rows({selected:!0}),i=0;i<e.context[0].aoColumns.length;i++){var n=e.context[0].aoColumns[i].data?e.context[0].aoColumns[i].data:e.context[0].aoColumns[i].mData?e.context[0].aoColumns[i].mData:e.context[0].aoColumns[i].idx;a[n]=o.data()[0][n]}t.onDeleteRow(t,a,function(e){t._deleteRowCallback(e)},function(e){t._errorCallback(e)})},_openAddModal:function(){this.s.dt;var e=this.completeColumnDefs(),a=(this.createDialog(e,this.language.add.title,this.language.add.button,this.language.modalClose,"addRowBtn","altEditor-add-form"),this.modal_selector);t(a+" input[0]").trigger("focus"),t(a).trigger("alteditor:some_dialog_opened").trigger("alteditor:add_dialog_opened")},completeColumnDefs:function(){var t=[],e=this.s.dt;for(var a in e.context[0].aoColumns){var o=e.context[0].aoColumns[a];t[a]={title:o.sTitle,placeholder:o.placeholder?o.placeholder:o.title,name:o.data?o.data:o.mData,type:o.type?o.type:"text",rows:o.rows?o.rows:"5",cols:o.cols?o.cols:"30",options:o.options?o.options:[],readonly:!!o.readonly&&o.readonly,disabled:!!o.disabled&&o.disabled,required:!!o.required&&o.required,hoverMsg:o.hoverMsg?o.hoverMsg:"",pattern:o.pattern?o.pattern:".*",accept:o.accept?o.accept:"",special:o.special?o.special:"",unique:!!o.unique&&o.unique,maxLength:!!o.maxLength&&o.maxLength,multiple:!!o.multiple&&o.multiple,select2:!!o.select2&&o.select2,datepicker:!!o.datepicker&&o.datepicker,datetimepicker:!!o.datetimepicker&&o.datetimepicker,editorOnChange:o.editorOnChange?o.editorOnChange:null,style:o.style?o.style:"",dateFormat:o.dateFormat?o.dateFormat:"",optionsSortByLabel:!!o.optionsSortByLabel&&o.optionsSortByLabel,inline:!!o.inline&&o.inline,step:o.step?o.step:null,min:o.min?o.min:null,max:o.max?o.max:null,value:o.value?o.value:""}}return t},createDialog:function(e,a,o,i,n,l){l=[l,this.random_id].join("-");var r=this,d="",s=0,u=function(t,e){var a="";for(var o in e){var i=e[o];t[i]&&(a+=" "+i+"='"+r._quoteattr(t[i])+"'")}return a+" "};for(var c in e){a=e[c].title.replace(/(<([^>]+)>)/gi,"").trim();if(e[c].type.indexOf("hidden")>=0)d+="<input type='hidden' id='"+this._quoteattr(e[c].name)+"' "+u(e[c],["name","value"])+"></input>";else{if(e[c].inline?0==s?(s++,d+="<div style='margin-left: initial;margin-right: initial;' class='form-group row' id='alteditor-row-"+this._quoteattr(e[c].name)+"'>",d+="<div class='col-sm-3 col-md-3 col-lg-3 text-right' style='padding-top:4px;'>",d+="<label for='"+this._quoteattr(e[c].name)+"'>"+a+":</label></div>",d+="<div class='col-sm-2 col-md-2 col-lg-2'>"):d+="<div class='col-sm-2 col-md-2 col-lg-2'>":(d+="<div style='margin-left: initial;margin-right: initial;' class='form-group row' id='alteditor-row-"+this._quoteattr(e[c].name)+"'>",d+="<div class='col-sm-3 col-md-3 col-lg-3 text-right' style='padding-top:4px;'>",d+="<label for='"+this._quoteattr(e[c].name)+"'>"+a+":</label></div>",d+="<div class='col-sm-8 col-md-8 col-lg-8'>"),e[c].type.indexOf("select")>=0){var p="",f=e[c].options;if(f.length>0)for(var g=0;g<f.length;g++)p+="<option value='"+this._quoteattr(f[g])+"'>"+f[g]+"</option>";else for(var m in f)p+="<option value='"+this._quoteattr(m)+"' >"+f[m]+"</option>";d+="<select class='form-control"+(e[c].select2?" select2":"")+"' "+u(e[c],["name","style","readonly","disabled","required","multiple"])+"id='"+this._quoteattr(e[c].name)+"' placeholder='"+this._quoteattr(e[c].placeholder?e[c].placeholder:a)+"' data-special='"+this._quoteattr(e[c].special)+"' data-unique='"+e[c].unique+"' >"+p+"</select>"}else e[c].type.indexOf("textarea")>=0?d+="<textarea class='form-control' id='"+this._quoteattr(e[c].name)+"' "+u(e[c],["name","style","rows","cols","maxlength","readonly","disabled","required"])+"placeholder='"+this._quoteattr(e[c].placeholder?e[c].placeholder:a)+"' data-special='"+this._quoteattr(e[c].special)+"' data-unique='"+e[c].unique+"'>"+(e[c].value?e[c].value:"")+"</textarea>":d+="<input class='form-control' "+u(e[c],["type","pattern","accept","name","step","min","max","maxlength","value","readonly","disabled","required"])+(e[c].type.indexOf("readonly")>=0?"readonly ":"")+"id='"+this._quoteattr(e[c].name)+"' title='"+this._quoteattr(e[c].hoverMsg)+"' placeholder='"+this._quoteattr(e[c].placeholder?e[c].placeholder:a)+"' data-special='"+this._quoteattr(e[c].special)+"' data-unique='"+e[c].unique+"' style='overflow: hidden; "+this._quoteattr(e[c].style)+"' class='form-control form-control-sm'>";d+="<label id='"+this._quoteattr(e[c].name)+"-label' class='errorLabel'></label>",!e[c].inline||+c+1<e.length&&!e[+c+1].inline?d+="</div><div style='clear:both;'></div></div>":d+="</div>"}}var h=this.modal_selector;this.internalOpenDialog(h,function(){var e='<button type="button" data-content="remove" class="btn btn-default button secondary" data-dismiss="modal" data-close>'+i+'</button><button type="submit" form="'+l+'" data-content="remove" class="btn btn-primary button" id="'+n+'">'+o+"</button>";t(h).find(".modal-title").html(a),t(h).find(".modal-body").html(d),t(h).find(".modal-footer").html(e);var r=t(h).find(".modal-content");r.parent().is("form")?(r.parent().attr("name",l),r.parent().attr("id",l)):r.wrap("<form name='"+l+"' id='"+l+"' role='form'></form>")}),t(h+" input[0]").trigger("focus");r=this;for(var c in e)if(e[c].select2?t(h).find("select#"+e[c].name).select2(e[c].select2):e[c].datepicker?t(h).find("#"+e[c].name).datepicker(e[c].datepicker):e[c].datetimepicker&&t(h).find("#"+e[c].name).datetimepicker(e[c].datetimepicker),e[c].editorOnChange&&(t(h).find("#"+t.escapeSelector(e[c].name)).attr("alt-editor-id",this._quoteattr(c)),t(h).find("#"+t.escapeSelector(e[c].name)).on("change",function(a){(0,e[t(this).attr("alt-editor-id")].editorOnChange)(a,r)})),e[c].type.indexOf("select")>=0&&e[c].optionsSortByLabel){var v="#"+e[c].name.toString().replace(/\./g,"\\."),b=t(h).find(v).find("option");b.sort(function(e,a){return t(e).text()>t(a).text()?1:-1}),t(h).find(v).html("").append(b),t(h).find(v).val(t(v+" option:first").val())}},_addRowData:function(){var e=this,a={},o=t('form[name="altEditor-add-form-'+this.random_id+'"]').find("select, textarea, input");o.filter(':input[type!="file"], :input[type="checkbox"]').each(function(e){a[t(this).attr("id")]=t(this).val()});var i=0;o.filter(':input[type="file"]').each(function(o){var n=this;t(this).prop("files")[0]&&(e.encodeFiles?(++i,e.getBase64(t(this).prop("files")[0],function(e){a[t(n).attr("id")]=e,--i})):a[t(this).attr("id")]=t(this).prop("files")[0])}),o.filter(':input[type="checkbox"]').each(function(e){a[t(this).attr("id")]=this.checked});var n=function(){0==i?e.onAddRow(e,a,function(t){e._addRowCallback(t)},function(t){e._errorCallback(t)}):(console.log("Waiting for file base64-decoding..."),setTimeout(n,1e3))};n()},_deleteRowCallback:function(e,a,o){var i=this.modal_selector;if(t(i+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(i);else{var n='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(i+" .modal-body").append(n)}this.s.dt.row({selected:!0}).remove(),this.s.dt.draw("page"),t("div"+i).find("button#addRowBtn").prop("disabled",!0),t("div"+i).find("button#editRowBtn").prop("disabled",!0),t("div"+i).find("button#deleteRowBtn").prop("disabled",!0)},_addRowCallback:function(e,a,o){var i="string"==typeof e?JSON.parse(e):e,n=this.modal_selector;if(t(n+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(n);else{var l='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(n+" .modal-body").append(l)}this.s.dt.row.add(i).draw(!1),t("div"+n).find("button#addRowBtn").prop("disabled",!0),t("div"+n).find("button#editRowBtn").prop("disabled",!0),t("div"+n).find("button#deleteRowBtn").prop("disabled",!0)},_editRowCallback:function(e,a,o){var i="string"==typeof e?JSON.parse(e):e,n=this.modal_selector;if(t(n+" .modal-body .alert").remove(),this.closeModalOnSuccess)this.internalCloseDialog(n);else{var l='<div class="alert alert-success" role="alert"><strong>'+this.language.success+"</strong></div>";t(n+" .modal-body").append(l)}this.s.dt.row({selected:!0}).data(i),this.s.dt.draw("page"),t("div"+n).find("button#addRowBtn").prop("disabled",!0),t("div"+n).find("button#editRowBtn").prop("disabled",!0),t("div"+n).find("button#deleteRowBtn").prop("disabled",!0)},_errorCallback:function(e,a,o){var i=e,n=this.modal_selector;t(n+" .modal-body .alert").remove();var l=this.language.error.message;if(i.responseJSON){if(i.responseJSON.errors)for(var r in l="",i.responseJSON.errors)l+=i.responseJSON.errors[r][0]}else l=i.responseText?i.responseText:null==i.status?"":this.language.error.responseCode+i.status;var d='<div class="alert alert-danger" role="alert"><strong>'+this.language.error.label+"</strong>"+(l?"<br />"+l:"")+"</div>";t(n+" .modal-body").append(d)},onAddRow:function(t,e,a,o){console.log("Missing AJAX configuration for INSERT"),a(e)},onEditRow:function(t,e,a,o){console.log("Missing AJAX configuration for UPDATE"),a(e)},onDeleteRow:function(t,e,a,o){console.log("Missing AJAX configuration for DELETE"),a(e)},internalOpenDialog(e,a){var o=t(e);if(o.modal)o.on("show.bs.modal",a),o.modal("show");else{if(!o.foundation)return void console.error("You must load Bootstrap or Foundation in order to open modal dialogs");o.on("open.zf.reveal",a),o.on("closed.zf.reveal",function(){t(".reveal-overlay").hide()}),new Foundation.Reveal(o).open()}},internalCloseDialog(e){var a=t(e);if(a.modal)a.modal("hide");else{if(!a.foundation)return void console.error("You must load Bootstrap or Foundation in order to open modal dialogs");new Foundation.Reveal(a).close(),t(".reveal-overlay").hide()}},reloadOptions:function(e,a){var o=e.val();e.empty(),a.length>0?t.each(a,function(a,o){e.append(t("<option></option>").attr("value",o).text(o))}):t.each(a,function(a,o){e.append(t("<option></option>").attr("value",o).text(a))}),e.val(o),e.trigger("change")},getBase64:function(t,e,a){var o=new FileReader;o.readAsDataURL(t),o.onload=function(){e&&e(o.result)},o.onerror=function(t){console.log("Error: ",t),a&&a(t)}},_quoteattr:function(t,e){if(null==t)return"";if(e=e?"&#13;":"\n",Array.isArray(t)){var a,o=[];for(a in t)o.push(t[a]);return o}return(""+t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,e).replace(/[\r\n]/g,e)}}),l.version="2.0",l.defaults={alwaysAsk:!1,focus:null,columns:"",update:null,editor:null},l.classes={btn:"btn"},t(a).on("preInit.dt.altEditor",function(e,a,o){if("dt"===e.namespace){var n=a.oInit.altEditor,r=i.defaults.altEditor;if(n||r){var d=t.extend({},n,r);if(!1!==n){var s=new l(a,d);e.target.altEditor=s}}}}),i.altEditor=l,l});